# 快速启动指南 - 使用状态功能

## 🚀 升级步骤（适用于现有用户）

### 1. 运行数据库迁移
```bash
# Windows
python migrate_add_used_field.py

# Linux/Mac
python3 migrate_add_used_field.py
```

### 2. 启动服务
```bash
# Windows
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Linux/Mac
./run.sh
# 或
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 3. 访问系统
打开浏览器访问: http://localhost:8000

## 📋 新功能使用指南

### 一键选中已激活未使用的卡片
1. 进入"卡片列表"页面
2. 点击"一键选中已激活未使用"按钮
3. 系统会自动勾选所有已激活且未使用的卡片
4. 然后可以进行批量操作：
   - 批量复制（格式：卡号|月|年|CVC，带空行分隔）
   - 批量标记已使用
   - 批量标记退款

### 批量标记为已使用
1. 勾选需要标记的卡片（或使用一键选中）
2. 点击"批量标记已使用"按钮
3. 确认操作
4. 系统会批量将选中的卡片标记为已使用

### 使用状态筛选
在卡片列表页面的筛选栏中：
- **全部使用状态**：显示所有卡片
- **已使用**：只显示已标记为使用的卡片
- **未使用**：只显示未标记为使用的卡片

### 单个卡片操作
在卡片列表的操作列中：
- 点击"标记使用"按钮标记单张卡片为已使用
- 点击"取消使用"按钮取消已使用标记

## 🔄 完整工作流程示例

### 场景：批量管理虚拟卡片
```
1. 批量导入卡片
   ├─ 进入"批量导入"页面
   └─ 粘贴卡片数据，点击"开始导入"

2. 批量激活卡片
   ├─ 进入"卡片列表"页面
   ├─ 勾选需要激活的卡片
   ├─ 点击"批量激活"
   └─ 等待激活完成（支持自动重试）

3. 筛选并复制未使用的卡片
   ├─ 点击"一键选中已激活未使用"
   ├─ 点击"批量复制"
   └─ 得到格式化的卡片信息（每张卡片一行，带空行分隔）
   
   示例输出：
   5236860109721326|12|2031|071
   
   5236860151859495|12|2031|523
   
   5236860106718044|12|2031|219

4. 使用后标记
   ├─ 使用完卡片后
   ├─ 选中已使用的卡片
   └─ 点击"批量标记已使用"

5. 查看未使用卡片
   ├─ 在"使用状态"筛选器中选择"未使用"
   └─ 快速找到还未使用的卡片
```

## 📊 卡片状态说明

### 激活状态
- ✅ **已激活**：卡片已从API激活，有卡号信息
- ⏳ **未激活**：卡片仅添加到数据库，未激活
- 🔴 **已过期**：卡片已超过有效期
- 🗑️ **已删除**：卡片已被软删除

### 使用状态（新增）
- ✅ **已使用**：卡片已标记为使用（手动标记）
- ⭕ **未使用**：卡片未被标记为使用

### 退款状态
- 💜 **已申请**：已标记为申请退款
- ⭕ **未申请**：未申请退款

## ⚙️ 配置说明

### 数据库位置
- 默认：`cards.db`（项目根目录）

### 端口配置
- 默认端口：8000
- 修改端口：编辑 `run.sh` 或启动命令中的 `--port` 参数

### API配置
API配置在 `app/config.py` 中：
- MISACARD_API_URL：MisaCard API地址
- 其他配置项

## 🛠️ 故障排除

### 问题：迁移后前端看不到新功能
**解决方案：**
1. 清空浏览器缓存
2. 硬刷新（Ctrl+Shift+R 或 Cmd+Shift+R）
3. 重启后端服务

### 问题：点击"一键选中"没反应
**解决方案：**
1. 检查是否有符合条件的卡片（已激活且未使用）
2. 查看浏览器控制台是否有错误
3. 刷新页面重试

### 问题：批量操作失败
**解决方案：**
1. 检查网络连接
2. 查看后端日志
3. 尝试单个操作确认问题

## 📞 技术支持

如遇到其他问题，请查看：
- `UPDATE_NOTES.md` - 详细更新说明
- `README.md` - 完整文档
- 浏览器控制台 - 查看前端错误
- 后端日志 - 查看API错误

## ✨ 提示与技巧

1. **组合筛选**：可以同时使用多个筛选条件，例如：
   - 状态筛选：已激活
   - 使用状态：未使用
   - 退款状态：未申请退款

2. **批量复制格式**：
   - 复制的卡片信息自动带空行分隔
   - 格式：`卡号|月份|年份|CVC`
   - 适合直接粘贴使用

3. **激活重试**：
   - 批量激活时失败的卡片会自动重试
   - 可以随时暂停/继续
   - 支持最小化窗口后台运行

4. **数据安全**：
   - 删除操作可以配置是否需要确认
   - 支持软删除（标记为已删除，不是物理删除）
   - 建议定期备份 `cards.db` 文件

祝使用愉快！🎉

