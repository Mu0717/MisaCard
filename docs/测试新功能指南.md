# 查询激活页面新功能 - 测试指南

## 🧪 测试准备

### 1. 启动应用
```bash
# Windows PowerShell
cd E:\Cursor脚本\MisaCard-Manager-main
python app/main.py

# 或使用启动脚本（如果配置了鉴权）
.\restart_with_auth.ps1
```

### 2. 访问应用
- 浏览器访问：http://localhost:8000
- 可以选择"访客模式"进入（无需登录）

---

## ✅ 测试清单

### 功能1：批量激活测试

#### 测试步骤

1. **进入批量激活模式**
   - [ ] 访问查询激活页面
   - [ ] 点击顶部的"批量激活"按钮
   - [ ] 确认界面切换成功

2. **输入测试数据**
   - [ ] 在文本框中输入多个卡密（每行一个）
   - [ ] 测试数据示例：
   ```
   mio-test-card-001
   mio-test-card-002
   mio-test-card-003
   ```

3. **执行批量激活**
   - [ ] 点击"批量激活"按钮
   - [ ] 确认弹出参数确认框
   - [ ] 点击确认开始激活

4. **验证激活过程**
   - [ ] 确认显示加载动画
   - [ ] 确认显示激活进度界面
   - [ ] 确认统计数据实时更新（总数、成功、失败）
   - [ ] 确认进度条正确显示

5. **验证激活结果**
   - [ ] 确认显示成功的卡片列表
   - [ ] 确认显示失败的卡片列表及原因
   - [ ] 确认显示完成提示
   - [ ] 确认成功后文本框被清空

#### 预期结果
- ✅ 界面正常切换
- ✅ 激活请求正常发送
- ✅ 进度正确显示
- ✅ 结果清晰展示
- ✅ 错误信息明确

#### 异常测试
- [ ] 输入空内容 → 应提示"请输入卡密"
- [ ] 输入无效卡密 → 应在失败列表中显示错误
- [ ] 网络错误 → 应显示网络错误提示

---

### 功能2：查询使用记录测试

#### 测试步骤

1. **准备已激活的卡片**
   - [ ] 切换到"单张激活"模式
   - [ ] 输入一个卡密
   - [ ] 点击"查询并自动激活"
   - [ ] 等待激活成功

2. **查看卡片信息**
   - [ ] 确认显示卡片基本信息
   - [ ] 确认显示卡号、CVC、有效期等
   - [ ] 确认状态为"已激活"

3. **查询使用记录**
   - [ ] 点击"查看使用记录"按钮
   - [ ] 确认显示加载动画
   - [ ] 等待加载完成

4. **验证使用记录显示**
   - [ ] 确认显示卡号
   - [ ] 确认显示状态
   - [ ] 确认显示余额（绿色）
   - [ ] 确认显示已用金额（蓝色）
   - [ ] 确认显示交易明细（如果有）

5. **验证交易明细**
   - [ ] 确认显示交易序号
   - [ ] 确认显示商户名称
   - [ ] 确认显示交易金额（支出红色）
   - [ ] 确认显示交易时间
   - [ ] 确认显示交易状态

#### 预期结果
- ✅ 激活成功后显示查看记录按钮
- ✅ 点击后正确加载使用记录
- ✅ 数据格式正确显示
- ✅ 颜色标识清晰（余额绿色、已用蓝色、支出红色）
- ✅ 无交易时显示"暂无交易记录"

#### 异常测试
- [ ] 未激活的卡片 → 不显示"查看使用记录"按钮
- [ ] API错误 → 显示错误提示
- [ ] 无交易记录 → 显示"暂无交易记录"

---

### 功能3：模式切换测试

#### 测试步骤

1. **单张 → 批量切换**
   - [ ] 在单张模式下点击"批量激活"按钮
   - [ ] 确认界面切换
   - [ ] 确认按钮样式变化

2. **批量 → 单张切换**
   - [ ] 在批量模式下点击"单张激活"按钮
   - [ ] 确认界面切换
   - [ ] 确认按钮样式变化

3. **数据保持测试**
   - [ ] 在单张模式输入数据
   - [ ] 切换到批量模式
   - [ ] 切换回单张模式
   - [ ] 确认数据未丢失

#### 预期结果
- ✅ 切换顺畅无卡顿
- ✅ 按钮样式正确变化
- ✅ 输入数据保持不变

---

## 🔍 详细测试场景

### 场景1：批量激活10张卡片

**测试数据：**
```
mio-card-001
mio-card-002
mio-card-003
mio-card-004
mio-card-005
mio-card-006
mio-card-007
mio-card-008
mio-card-009
mio-card-010
```

**预期结果：**
- 激活过程约 10-30 秒（取决于网络和服务器）
- 显示详细的成功/失败统计
- 失败的卡片会自动重试3次
- 最终显示完整的激活报告

---

### 场景2：查询已激活卡片的使用记录

**测试步骤：**
1. 输入已激活的卡密（例如：mio-xxxxx-xxxxx-xxxxx）
2. 点击"查询并自动激活"
3. 等待显示卡片信息
4. 点击"查看使用记录"
5. 验证显示的使用记录

**预期结果：**
```
使用记录
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
卡号：5123 **** **** 1234
状态：active
余额：$8.50
已用：$1.50

交易明细 (2 笔)：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#1 Amazon.com                 -$0.99
   时间: 2024-12-11 10:30:00
   状态: completed

#2 Netflix                    -$0.51
   时间: 2024-12-11 09:15:00
   状态: completed
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### 场景3：访客模式完整流程

**测试步骤：**
1. 打开浏览器访问 http://localhost:8000
2. 点击"无需登录，直接使用查询激活"
3. 进入查询激活页面
4. 测试单张激活功能
5. 测试批量激活功能
6. 测试查询使用记录功能

**验证点：**
- [ ] 无需登录即可访问
- [ ] 所有功能正常可用
- [ ] 导航栏只显示"查询激活"选项
- [ ] 其他功能显示需要登录提示

---

## 🐛 已知问题排查

### 问题1：批量激活失败率高
**可能原因：**
- 卡密无效或不存在
- 网络连接不稳定
- API服务器响应慢

**解决方案：**
- 检查卡密是否正确
- 重试失败的卡片
- 降低并发数（修改前端代码中的concurrency值）

### 问题2：使用记录不显示
**可能原因：**
- 卡片未激活
- API返回数据为空
- 网络错误

**解决方案：**
- 确认卡片已激活（有卡号）
- 检查网络连接
- 查看浏览器控制台错误信息

### 问题3：界面显示异常
**可能原因：**
- 浏览器缓存
- CSS加载失败

**解决方案：**
- 清除浏览器缓存
- 强制刷新（Ctrl + F5）
- 尝试其他浏览器

---

## 📊 测试报告模板

### 测试环境
- 操作系统：Windows 11
- 浏览器：Chrome 120
- 应用版本：1.0
- 测试日期：2024-12-11

### 测试结果

| 功能 | 测试项 | 结果 | 备注 |
|------|--------|------|------|
| 批量激活 | 界面切换 | ✅ | 正常 |
| 批量激活 | 输入验证 | ✅ | 正常 |
| 批量激活 | 激活处理 | ✅ | 正常 |
| 批量激活 | 结果显示 | ✅ | 正常 |
| 查询记录 | 按钮显示 | ✅ | 正常 |
| 查询记录 | 数据加载 | ✅ | 正常 |
| 查询记录 | 信息展示 | ✅ | 正常 |
| 模式切换 | 切换功能 | ✅ | 正常 |

### 问题记录
1. 无

### 改进建议
1. 考虑增加导出功能
2. 添加更多筛选条件

---

## 🎯 快速测试命令

### 1. 启动应用（PowerShell）
```powershell
cd E:\Cursor脚本\MisaCard-Manager-main
python app/main.py
```

### 2. 测试API（可选）
```powershell
# 测试批量激活API
curl -X POST http://localhost:8000/api/cards/batch/activate `
  -H "Content-Type: application/json" `
  -d '{
    "card_ids": ["mio-test-001", "mio-test-002"],
    "concurrency": 5,
    "max_retries": 3
  }'

# 测试查询使用记录API
curl http://localhost:8000/api/cards/mio-test-001/transactions
```

---

## 📝 测试完成检查清单

- [ ] 批量激活功能正常
- [ ] 查询使用记录功能正常
- [ ] 模式切换功能正常
- [ ] 错误处理正确
- [ ] 界面显示美观
- [ ] 访客模式可用
- [ ] 所有测试场景通过
- [ ] 无明显Bug
- [ ] 文档更新完成

---

**测试完成！** 🎉

如有任何问题，请查看：
- `/docs/QUERY_PAGE_FEATURES.md` - 功能详细说明
- `/docs/BATCH_ACTIVATE_README.md` - 批量激活说明
- 浏览器控制台 - 查看前端错误
- 应用控制台 - 查看后端日志

